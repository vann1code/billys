<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="body">
        <h:form id="formPrescricao">

            <p:growl id="msg" showDetail="true" life="4000"/>

            <div class="grid">

                <div class="col-12">
                    <p:card style="margin-bottom: 20px">
                        <f:facet name="title">
                            <i class="pi pi-user-edit" style="margin-right: 10px"/>Nova Prescrição
                        </f:facet>

                        <div class="ui-fluid formgrid grid">

                            <div class="field col-12 md:col-6">
                                <p:outputLabel for="paciente" value="Selecione o Paciente"/>
                                <p:selectOneMenu id="paciente" value="#{prescricaoBean.pacienteIdSelecionado}"
                                                 filter="true" filterMatchMode="contains"
                                                 required="true" requiredMessage="Informe o paciente">
                                    <f:selectItem itemLabel="Selecione..." itemValue="#{null}"/>
                                    <f:selectItems value="#{prescricaoBean.listaPacientes}" var="p"
                                                   itemLabel="#{p.nome} (CPF: #{p.cpf})" itemValue="#{p.id}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="field col-12 md:col-6">
                                <p:outputLabel value="Médico Responsável"/>
                                <p:inputText value="#{loginBean.usuarioLogado.nome}" readonly="true"/>
                            </div>
                        </div>
                    </p:card>
                </div>

                <div class="col-12">
                    <p:card style="margin-bottom: 20px">
                        <f:facet name="title">Adicionar Medicamentos</f:facet>

                        <h:panelGroup id="painelItem" styleClass="ui-fluid formgrid grid">

                            <div class="field col-12 md:col-5">
                                <p:outputLabel for="prod" value="Medicamento"/>
                                <p:selectOneMenu id="prod" value="#{prescricaoBean.produtoIdSelecionado}"
                                                 filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="Selecione..." itemValue="#{null}"/>
                                    <f:selectItems value="#{prescricaoBean.listaProdutos}" var="prod"
                                                   itemLabel="#{prod.nome} (Disp: #{prod.estoque})" itemValue="#{prod.id}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="field col-12 md:col-2">
                                <p:outputLabel for="qtd" value="Qtd"/>
                                <p:spinner id="qtd" value="#{prescricaoBean.item.quantidade}" min="1" buttons="horizontal"/>
                            </div>

                            <div class="field col-12 md:col-5">
                                <p:outputLabel for="poso" value="Posologia (Como tomar)"/>
                                <p:inputText id="poso" value="#{prescricaoBean.item.posologia}"
                                             placeholder="Ex: Tomar 1cp de 8 em 8 horas"/>
                            </div>

                            <div class="field col-12">
                                <p:commandButton value="Adicionar Item" action="#{prescricaoBean.adicionarItem}"
                                                 update="tabelaItens painelItem msg"
                                                 process="@this painelItem"
                                                 icon="pi pi-plus" styleClass="ui-button-outlined ui-button-secondary"/>
                            </div>
                        </h:panelGroup>
                    </p:card>
                </div>

                <div class="col-12">
                    <p:card>
                        <f:facet name="title">Resumo da Receita</f:facet>

                        <p:dataTable id="tabelaItens" value="#{prescricaoBean.prescricao.itens}" var="item"
                                     emptyMessage="Nenhum medicamento adicionado ainda." reflow="true">

                            <p:column headerText="Medicamento">
                                <h:outputText value="#{item.produto.nome}" style="font-weight: bold"/>
                            </p:column>

                            <p:column headerText="Qtd" width="100" style="text-align: center">
                                <h:outputText value="#{item.quantidade}"/>
                            </p:column>

                            <p:column headerText="Posologia">
                                <h:outputText value="#{item.posologia}"/>
                            </p:column>

                            <p:column width="80" style="text-align: center">
                                <p:commandButton icon="pi pi-trash" action="#{prescricaoBean.removerItem(item)}"
                                                 process="@this" update="tabelaItens"
                                                 styleClass="rounded-button ui-button-flat ui-button-danger"/>
                            </p:column>

                        </p:dataTable>

                        <f:facet name="footer">
                            <div style="text-align: right; padding-top: 10px;">

                                <p:button value="Cancelar" outcome="prescricao"
                                          icon="pi pi-times" styleClass="ui-button-secondary"
                                          style="margin-right: 10px"/>

                                <p:commandButton value="Finalizar Prescrição" action="#{prescricaoBean.salvar}"
                                                 update="@form" icon="pi pi-check"
                                                 styleClass="ui-button-success ui-button-lg"/>
                            </div>
                        </f:facet>
                    </p:card>
                </div>

            </div>
        </h:form>
    </ui:define>

</ui:composition>